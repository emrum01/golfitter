# language: ja
フィーチャ: Golfitterアプリケーション
  ゴルフスイング分析と記録管理を行うWebアプリケーション

  背景:
    前提 ユーザーがGolfitterアプリケーションにアクセスしている

  シナリオ: ホーム画面の表示
    前提 ユーザーがホーム画面にアクセスしている
    もし ページが読み込まれたとき
    ならば Next.jsロゴが表示される
    かつ "手順説明"が表示される
    かつ "Deploy now"ボタンが表示される
    かつ "Read our docs"ボタンが表示される

  シナリオ: 外部認証プロバイダーによる認証フロー
    前提 ユーザーが外部認証プロバイダーから認証コールバックを受け取っている
    もし "/auth/callback"にリダイレクトされたとき
    ならば "認証中..."のローディング表示が見える
    
    シナリオ: 認証成功時の処理
      もし 認証が成功したとき
      ならば ホーム画面にリダイレクトされる

    シナリオ: 認証失敗時の処理
      もし 認証が失敗したとき
      ならば "認証エラー"が表示される
      かつ "認証に失敗しました。もう一度お試しください。"のメッセージが表示される
      かつ "ホームに戻る"ボタンが表示される

  シナリオ: スイング比較機能
    前提 ユーザーがスイング比較画面にアクセスしている
    もし "/swing-comparison"にアクセスしたとき
    ならば SwingComparisonコンポーネントが表示される

    シナリオ: 診断結果からのプリセット比較
      前提 URLパラメータで"video2"と"proName"が指定されている
      もし 診断結果画面から遷移したとき
      ならば プロゴルファーの動画がプリセットされる
      かつ 分析結果は未取得状態で表示される

    シナリオ: スイング分析の実行
      もし "分析開始"アクションを実行したとき
      ならば ローディング状態が表示される
      
      もし 分析が完了したとき
      ならば 分析結果が表示される

    シナリオ: 診断結果画面への戻る
      もし "戻る"ボタンをクリックしたとき
      ならば "/?currentStep=results"に遷移する

  シナリオ: スイング動画のアップロードと管理
    前提 認証済みユーザーがスイングアップロード画面にアクセスしている
    もし "/swing-upload"にアクセスしたとき
    ならば "スイング動画のアップロード"のタイトルが表示される
    かつ "あなたのゴルフスイングを分析して、改善点を見つけましょう"のサブタイトルが表示される
    かつ VideoUploadコンポーネントが表示される

    シナリオ: 新規動画のアップロード
      前提 VideoUploadコンポーネントが表示されている
      もし 動画ファイルをアップロードしたとき
      ならば 動画が保存される
      かつ 保存済み動画一覧が更新される

    シナリオ: 保存済み動画の表示
      前提 保存済み動画が存在する
      もし ページが読み込まれたとき
      ならば "保存済みの動画"カードが表示される
      かつ 動画一覧が新しい順で表示される
      かつ 各動画にファイル名、サイズ、アップロード日時が表示される

    シナリオ: 保存済み動画が存在しない場合
      前提 保存済み動画が存在しない
      もし ページが読み込まれたとき
      ならば 保存済み動画セクションが非表示になる

    シナリオ: 動画の選択と分析
      前提 保存済み動画が表示されている
      もし 動画カードをクリックしたとき
      ならば 動画が選択状態になる（青枠、青背景）
      
      もし "分析"ボタンをクリックしたとき
      ならば "/analysis?videoId={選択した動画ID}"に遷移する

    シナリオ: 動画の削除
      前提 保存済み動画が表示されている
      もし 削除ボタンをクリックしたとき
      ならば 確認なしで動画が削除される
      かつ 動画一覧が更新される
      かつ 選択中の動画だった場合は選択が解除される

    シナリオ: 未認証ユーザーのアクセス制御
      前提 未認証ユーザーがスイングアップロード画面にアクセスしようとしている
      もし "/swing-upload"にアクセスしたとき
      ならば ProtectedRouteコンポーネントによってリダイレクトされる

  シナリオ: 動画一覧ビューアー（モバイル最適化）
    前提 ユーザーが動画一覧画面にアクセスしている
    もし "/videos"にアクセスしたとき
    ならば 黒背景の全画面表示になる

    シナリオ: 動画読み込み中の表示
      前提 動画を読み込み中である
      もし ページが読み込まれたとき
      ならば "動画を読み込み中..."のメッセージが白文字で表示される

    シナリオ: 動画が存在しない場合
      前提 アップロードされた動画が存在しない
      もし ページが読み込まれたとき
      ならば "まだ動画がアップロードされていません"のメッセージが表示される
      かつ "動画をアップロード"ボタンが表示される
      
      もし "動画をアップロード"ボタンをクリックしたとき
      ならば "/swing-upload"に遷移する

    シナリオ: 動画ビューアーでのスワイプ操作
      前提 動画が存在する
      もし ページが読み込まれたとき
      ならば Swiperコンポーネントで動画一覧が表示される
      かつ MobileVideoPlayerコンポーネントで各動画が表示される
      かつ 動画タイトルが "{動画名} ({現在の番号}/{総数})" 形式で表示される

      もし 右にスワイプしたとき
      ならば 次の動画が表示される

      もし 左にスワイプしたとき
      ならば 前の動画が表示される

    シナリオ: PC環境でのナビゲーション
      前提 PC環境（640px以上）でアクセスしている
      かつ 動画が存在する
      もし ページが読み込まれたとき
      ならば 前後の動画への移動ボタンが表示される
      かつ ページネーションドットが表示される

      もし 右矢印ボタンをクリックしたとき
      ならば 次の動画が表示される

      もし 左矢印ボタンをクリックしたとき
      ならば 前の動画が表示される

    シナリオ: モバイル環境での表示
      前提 モバイル環境（640px以下）でアクセスしている
      もし ページが読み込まれたとき
      ならば 矢印ナビゲーションが非表示になる

    シナリオ: 診断結果画面への戻る
      もし 戻るボタン（ArrowLeftアイコン）をクリックしたとき
      ならば "/?currentStep=results"に遷移する

    シナリオ: メモリリーク防止
      もし コンポーネントがアンマウントされるとき
      ならば BlobURLが適切に解放される

  シナリオ: エラーハンドリング
    シナリオ: 動画読み込みエラー（スイングアップロード）
      前提 スイングアップロード画面が表示されている
      もし 動画の読み込みでエラーが発生したとき
      ならば コンソールに"動画の読み込みに失敗しました"が出力される

    シナリオ: 動画削除エラー（スイングアップロード）
      前提 スイングアップロード画面で動画を削除しようとしている
      もし 動画の削除でエラーが発生したとき
      ならば コンソールに"動画の削除に失敗しました"が出力される

    シナリオ: 動画読み込みエラー（動画一覧）
      前提 動画一覧画面が表示されている
      もし 動画の読み込みでエラーが発生したとき
      ならば コンソールに"Failed to load videos"が出力される

    シナリオ: スイング分析エラー
      前提 スイング比較画面で分析を実行している
      もし 分析処理でエラーが発生したとき
      ならば エラーメッセージが表示される

  シナリオ: 画面間の遷移フロー
    シナリオ: 診断結果からスイング比較への遷移
      前提 診断結果画面が表示されている
      もし "スイング比較"ボタンをクリックしたとき
      ならば "/swing-comparison"に遷移する
      かつ URLパラメータで"video2"と"proName"が渡される

    シナリオ: 診断結果からスイングアップロードへの遷移
      前提 診断結果画面が表示されている
      もし "スイングアップロード"ボタンをクリックしたとき
      ならば "/swing-upload"に遷移する

    シナリオ: 診断結果から動画一覧への遷移
      前提 診断結果画面が表示されている
      もし "動画一覧"ボタンをクリックしたとき
      ならば "/videos"に遷移する

    シナリオ: 各画面から診断結果への戻る
      前提 スイング比較、スイングアップロード、または動画一覧画面が表示されている
      もし "戻る"ボタンをクリックしたとき
      ならば "/?currentStep=results"に遷移する