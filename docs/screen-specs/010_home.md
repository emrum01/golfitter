# 画面概要

この画面は、Golfitterアプリケーションのメイン機能である「ゴルフフィッター」として機能します。ユーザーの身体データとプレイ情報を入力してAI診断を行い、最適なプロゴルファーとクラブセットを提案します。認証が必要な画面です。

# 画面仕様

## 基本情報

| 項目           | 内容                         |
| -------------- | ---------------------------- |
| ページタイトル | ゴルフフィッター             |
| 画面ID         | HOME_001                     |
| 本番URL        | /                           |
| storybook      | -                           |

## 画面の状態管理

| **初期表示** | 身体データとプレイ情報の入力フォームを表示 |
| **診断結果表示** | セッションストレージから復元されたマッチング結果を表示 |
| **スイング分析** | SwingAnalysisコンポーネントを表示 |
| ------------ | ------------------------------------ |

## 画面要素

### ヘッダー

**入力項目一覧**

| 項目名   | 必須        | 種別   | デフォルト     | 文字種   | 文字数   | 説明   |
| -------- | ----------- | ------ | -------------- | -------- | -------- | ------ |
| -        | -           | -      | -              | -        | -        | -      |

**出力項目一覧**

| 項目名   | 説明   |
| -------- | ------ |
| ロゴ | Golfitterアプリケーションロゴ |
| ユーザー情報 | アバター、メールアドレス表示 |
| ログアウトボタン | 認証セッション終了ボタン |

**バリデーション一覧**

| エラー概要   | エラーメッセージ   | エラー原因   |
| ------------ | ------------------ | ------------ |
| サインアウトエラー | コンソールに「サインアウトエラー」表示 | 認証サービスでエラー発生 |

**備考**

| 項目   | 内容   |
| ------ | ------ |
| 認証状態 | useAuthフックでユーザー情報を取得 |
| アバター | user_metadata.avatar_urlまたはメール先頭文字 |

### 身体データカード

**入力項目一覧**

| 項目名   | 必須        | 種別   | デフォルト     | 文字種   | 文字数   | 説明   |
| -------- | ----------- | ------ | -------------- | -------- | -------- | ------ |
| お名前 | ○ | text | ユーザーのメタデータから自動設定 | 文字列 | - | ユーザーの名前 |
| 身長 | ○ | number | - | 数値 | - | 身長（cm単位） |
| 体重 | ○ | number | - | 数値 | - | 体重（kg単位） |
| 腕の長さ | ○ | number | - | 数値 | - | 腕の長さ（cm単位） |
| 筋力レベル | ○ | select | 1 | 数値（1-5） | - | 筋力レベル（1:低い - 5:高い） |

**出力項目一覧**

| 項目名   | 説明   |
| -------- | ------ |
| カードタイトル | 「身体データ」アイコン付き |
| カード説明 | 「あなたの身体的特徴を入力してください」 |
| 入力フォーム | 各項目の入力フィールド |

**バリデーション一覧**

| エラー概要   | エラーメッセージ   | エラー原因   |
| ------------ | ------------------ | ------------ |
| 必須項目未入力 | ボタンが無効化される | 名前、身長、体重が未入力 |

**備考**

| 項目   | 内容   |
| ------ | ------ |
| 初期値 | user?.user_metadata?.full_name || user?.email || '' |
| 筋力レベル | SelectContentで1-5の選択肢を提供 |

### プレイ情報カード

**入力項目一覧**

| 項目名   | 必須        | 種別   | デフォルト     | 文字種   | 文字数   | 説明   |
| -------- | ----------- | ------ | -------------- | -------- | -------- | ------ |
| 現在のスコア | ○ | number | - | 数値 | - | 現在の平均スコア |
| 目標スコア | ○ | number | - | 数値 | - | 目標とするスコア |
| 経験年数 | ○ | number | - | 数値 | - | ゴルフ経験年数 |
| 予算 | ○ | number | - | 数値 | - | クラブ購入予算（円） |
| プロフィール画像 | - | file | - | 画像ファイル | - | プロフィール画像（オプション） |

**出力項目一覧**

| 項目名   | 説明   |
| -------- | ------ |
| カードタイトル | 「プレイ情報」アイコン付き |
| カード説明 | 「あなたのゴルフ経験と目標を入力してください」 |
| 入力フォーム | 各項目の入力フィールド |
| アップロードエリア | 画像アップロード用の破線枠 |

**バリデーション一覧**

| エラー概要   | エラーメッセージ   | エラー原因   |
| ------------ | ------------------ | ------------ |
| -            | -                  | -            |

**備考**

| 項目   | 内容   |
| ------ | ------ |
| 画像アップロード | 現在は表示のみで機能未実装 |
| 予算表示 | 診断結果で予算範囲内のクラブセット表示に使用 |

### 診断結果表示

**入力項目一覧**

| 項目名   | 必須        | 種別   | デフォルト     | 文字種   | 文字数   | 説明   |
| -------- | ----------- | ------ | -------------- | -------- | -------- | ------ |
| -        | -           | -      | -              | -        | -        | -      |

**出力項目一覧**

| 項目名   | 説明   |
| -------- | ------ |
| マッチしたプロゴルファー | AI診断結果のプロゴルファー情報 |
| 推奨クラブセット | マッチしたプロが使用するクラブセット |
| スイングフォーム提案 | 動画プレーヤーと改善ポイント |
| アクションボタン群 | スイング分析、スイング比較、動画一覧等のボタン |

**バリデーション一覧**

| エラー概要   | エラーメッセージ   | エラー原因   |
| ------------ | ------------------ | ------------ |
| -            | -                  | -            |

**備考**

| 項目   | 内容   |
| ------ | ------ |
| セッション管理 | sessionStorageで診断結果を永続化 |
| 動画切り替え | currentVideoIndexで2つの動画を切り替え可能 |
| 予算表示 | 「予算内で購入可能なクラブセットです」を表示 |

## 使用API

| 項目名       | 機能       |
| ------------ | ---------- |
| findBestMatch | 入力された身体データに基づいて最適なプロゴルファーをマッチング |
| sessionStorage | 診断結果の保存・復元 |
| useAuth | 認証状態とユーザー情報の取得 |
| useSearchParams | URLパラメータからcurrentStepを取得 |

## エラー／例外ケース

| エラー概要   | エラーメッセージ   | エラー原因   |
| ------------ | ------------------ | ------------ |
| サインアウト失敗 | 「サインアウトエラー」をコンソールに出力 | 認証サービスでエラー発生 |

## 権限による表示制御

| 権限     | アクセス可能URL   | 表示内容   |
| -------- | ----------------- | ---------- |
| 認証済みユーザー | / | ゴルフフィッター機能 |
| 未認証ユーザー | / | ログイン画面へリダイレクト |

## 状態／シナリオ別表示仕様

| 状態／シナリオ | 条件                           | 表示／非表示／制御内容               | 備考                     |
| -------------- | ------------------------------ | ------------------------------------ | ------------------------ |
| 入力フォーム表示 | currentStep === 'input'        | 身体データとプレイ情報の入力フォーム | 初期状態 |
| 診断結果表示   | currentStep === 'results'      | マッチしたプロとクラブセット、改善ポイント | セッションストレージから復元可能 |
| スイング分析   | currentStep === 'swing-analysis' | SwingAnalysisコンポーネント | onBackで診断結果に戻る |
| URLパラメータ復元 | ?currentStep=results           | セッションストレージから診断結果を復元 | ブラウザ戻るボタン対応 |
| セッション復元 | 保存された診断結果あり         | 自動的に診断結果画面を表示           | アプリ起動時 |
| 動画切り替え   | ChevronLeftまたはChevronRightクリック | 表示動画を切り替え                   | currentVideoIndexで管理 |

# 画面遷移元

| 権限     | 遷移元   | アクション   |
| -------- | -------- | ------------ |
| 認証済みユーザー | 直接アクセス | URL入力 |
| 認証済みユーザー | 動画一覧画面 | 戻るボタンクリック |
| 認証済みユーザー | スイング比較画面 | 戻るボタンクリック |
| 認証済みユーザー | スイングアップロード画面 | 戻るボタンクリック |

## アクション一覧 (Gherkin形式)

### AI診断機能

```gherkin
機能: ユーザーの身体データとプレイ情報に基づいてAI診断を実行する

  シナリオ: 初回診断実行
    前提 ユーザーが認証済みで入力フォーム画面を表示している
    もし 必須項目（名前、身長、体重）を入力して「AI診断を開始」ボタンをクリックする
    ならば findBestMatchアルゴリズムが実行され、最適なプロゴルファーがマッチングされる
    かつ 診断結果がセッションストレージに保存される
    かつ currentStepが'results'に変更され、診断結果画面が表示される
    
  シナリオ: 診断結果の復元
    前提 過去に診断を実行してセッションストレージに結果が保存されている
    もし URLパラメータに?currentStep=resultsを指定してアクセスする
    ならば セッションストレージから診断結果が復元される
    かつ 診断結果画面が表示される
```

### 画面遷移機能

```gherkin
機能: 診断結果から各機能画面への遷移

  シナリオ: スイング分析への遷移
    前提 診断結果画面を表示している
    もし 「スイング分析」ボタンをクリックする
    ならば currentStepが'swing-analysis'に変更される
    かつ SwingAnalysisコンポーネントが表示される
    
  シナリオ: スイング比較への遷移
    前提 診断結果画面を表示している
    もし 「スイング比較」ボタンをクリックする
    ならば /swing-comparisonページに遷移する
    かつ URLパラメータにvideo2とproNameが設定される
    
  シナリオ: 再診断の実行
    前提 診断結果画面を表示している
    もし 「再診断する」ボタンをクリックする
    ならば セッションストレージがクリアされる
    かつ currentStepが'input'に変更される
    かつ 入力フォーム画面が表示される
```

### セッション管理機能

```gherkin
機能: 診断結果のセッション管理

  シナリオ: ログアウト処理
    前提 ユーザーがログイン状態である
    もし ヘッダーの「ログアウト」ボタンをクリックする
    ならば signOut関数が実行される
    かつ 認証セッションが終了される
    
  シナリオ: 動画切り替え操作
    前提 診断結果画面のスイングフォーム提案セクションを表示している
    もし 動画プレーヤーの左右矢印ボタンをクリックする
    ならば currentVideoIndexが切り替わる
    かつ 表示される動画が変更される
    かつ 動画番号インジケーターが更新される
```

# 備考

- ProtectedRouteで認証が必要
- useAuthフックでユーザー情報を取得
- セッションストレージで診断結果を永続化
- URLパラメータ（currentStep）で画面状態を制御
- findBestMatchアルゴリズムで身体データの類似度を計算
- レスポンシブデザイン対応済み（TailwindCSSのユーティリティクラスを使用）
- MobileVideoPlayerコンポーネントでプロゴルファーの動画を表示
- 診断結果からの動画比較機能との連携