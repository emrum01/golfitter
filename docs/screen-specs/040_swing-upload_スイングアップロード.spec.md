# 画面概要

この画面は、ゴルフスイングの動画をアップロードし、保存済みの動画を管理するための画面です。ユーザーは新しい動画をアップロードしたり、保存済みの動画を選択して分析画面に遷移することができます。この画面は認証済みユーザーのみアクセス可能です。

# 画面仕様

## 基本情報

| 項目           | 内容                         |
| -------------- | ---------------------------- |
| ページタイトル | スイング動画のアップロード   |
| 画面ID         | swing-upload                 |
| 本番URL        | /swing-upload               |
| storybook      | ----                        |

## 画面の状態管理

| **初期表示** | VideoUploadコンポーネントと保存済み動画一覧を表示 |
| ------------ | ------------------------------------------------ |

## 画面要素

### ヘッダー部分

**出力項目一覧**

| 項目名             | 説明                                                    |
| ----------------- | ------------------------------------------------------- |
| 戻るボタン         | 診断結果画面への戻るボタン（ChevronLeftアイコン付き）    |
| タイトル          | 「スイング動画のアップロード」を表示                     |
| サブタイトル       | 「あなたのゴルフスイングを分析して、改善点を見つけましょう」 |

### VideoUploadコンポーネント

**入力項目一覧**

| 項目名   | 必須        | 種別        | デフォルト     | 文字種   | 文字数   | 説明                       |
| -------- | ----------- | ----------- | -------------- | -------- | -------- | -------------------------- |
| 動画ファイル | 必須        | ファイル     | ----           | ----     | ----     | アップロードする動画ファイル |

### 保存済み動画一覧

**出力項目一覧**

| 項目名             | 説明                                              |
| ----------------- | ------------------------------------------------- |
| カードタイトル     | 「保存済みの動画」を表示                           |
| カード説明        | 「クリックして動画を選択し、分析を開始できます」    |
| 動画リスト        | 保存済み動画の一覧（新しい順）                     |
| 動画名            | 各動画のファイル名                                 |
| ファイルサイズ     | MB単位で表示                                      |
| アップロード日時   | 日本時間フォーマットで表示                         |
| 削除ボタン        | 各動画の削除ボタン                                 |
| 分析ボタン        | 選択した動画を分析するボタン                       |

**バリデーション一覧**

| エラー概要           | エラーメッセージ                        | エラー原因              |
| ------------------- | -------------------------------------- | ---------------------- |
| 動画読み込みエラー   | コンソールに「動画の読み込みに失敗しました」 | videoStorage.getAllVideosの失敗 |
| 動画削除エラー      | コンソールに「動画の削除に失敗しました」    | videoStorage.deleteVideoの失敗  |

## 使用API

| 項目名                          | 機能                          |
| ------------------------------ | ----------------------------- |
| videoStorage.getAllVideos()     | 保存済み動画の一覧を取得       |
| videoStorage.deleteVideo()      | 指定した動画を削除            |

## エラー／例外ケース

| エラー概要           | エラーメッセージ                        | エラー原因                    |
| ------------------- | -------------------------------------- | ---------------------------- |
| 動画読み込み失敗     | 動画の読み込みに失敗しました             | ストレージアクセスエラー       |
| 動画削除失敗        | 動画の削除に失敗しました                | ストレージ削除エラー          |

## 権限による表示制御

| 権限                   | アクセス可能URL | 表示内容                               |
| --------------------- | -------------- | ------------------------------------- |
| 認証済みユーザー       | /swing-upload  | 全ての機能を表示                       |
| 未認証ユーザー        | ----           | ProtectedRouteコンポーネントでリダイレクト |

## 状態／シナリオ別表示仕様

| 状態／シナリオ     | 条件                           | 表示／非表示／制御内容                              | 備考                           |
| ----------------- | ----------------------------- | -------------------------------------------------- | ----------------------------- |
| 初期表示          | ページロード時                 | VideoUploadコンポーネントを表示、動画一覧を読み込み  | useEffectで自動実行            |
| 動画なし          | savedVideos.length === 0      | 保存済み動画セクションを非表示                      | 条件付きレンダリング            |
| 動画あり          | savedVideos.length > 0        | 保存済み動画一覧を表示                              | 新しい順にソート               |
| 動画選択時        | 動画カードクリック             | 選択状態をハイライト（青枠、青背景）                | selectedVideoで管理            |
| アップロード完了   | onUploadCompleteコールバック   | savedVideoIdを更新し、動画一覧を再読み込み          | loadSavedVideosを実行          |
| 動画削除時        | 削除ボタンクリック             | 確認なしで即削除、一覧を更新                        | 選択中の動画なら選択解除        |

# 画面遷移元

| 権限                | 遷移元          | アクション                     |
| ------------------ | -------------- | ----------------------------- |
| 認証済みユーザー    | 診断結果画面    | スイングアップロードボタンクリック |
| 認証済みユーザー    | その他の画面    | URLの直接入力                  |

## アクション一覧

| タイトル              | アクション方法          | 説明                                              |
| -------------------- | ---------------------- | ------------------------------------------------- |
| 診断結果に戻る        | 戻るボタンクリック      | /?currentStep=resultsに遷移                       |
| 動画アップロード      | VideoUploadコンポーネント | 新しい動画をアップロード                            |
| 動画選択             | 動画カードクリック      | 動画を選択状態にする                               |
| 動画削除             | 削除ボタンクリック      | 選択した動画を削除（確認なし）                      |
| 分析開始             | 分析ボタンクリック      | /analysis?videoId={選択した動画ID}に遷移            |

# 備考

- ProtectedRouteコンポーネントでラップされており、認証が必要
- 動画の保存にはIndexedDBベースのvideoStorageを使用
- ファイルサイズはMB単位で小数点2桁まで表示
- 日時表示は日本のロケールフォーマットを使用
- 削除操作に確認ダイアログはない（即削除）