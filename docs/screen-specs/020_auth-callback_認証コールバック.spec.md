# 画面概要

この画面は、外部認証プロバイダーからのリダイレクトを処理し、認証セッションを確立するための中間画面です。認証が成功した場合はホーム画面にリダイレクトし、失敗した場合はエラーメッセージを表示します。

# 画面仕様

## 基本情報

| 項目           | 内容                         |
| -------------- | ---------------------------- |
| ページタイトル | 認証コールバック             |
| 画面ID         | auth-callback                |
| 本番URL        | /auth/callback              |
| storybook      | ----                        |

## 画面の状態管理

| **初期表示** | 認証処理中のローディング状態を表示 |
| ------------ | --------------------------------- |

## 画面要素

### 認証処理中表示

**出力項目一覧**

| 項目名           | 説明                                    |
| ---------------- | --------------------------------------- |
| ローディング     | アニメーション付きのスピナーを表示      |
| メッセージ       | 「認証中...」のテキストを表示           |

### エラー表示

**出力項目一覧**

| 項目名           | 説明                                    |
| ---------------- | --------------------------------------- |
| エラータイトル   | 「認証エラー」を赤色で表示              |
| エラーメッセージ | エラーの詳細内容を表示                  |
| ホームボタン     | ホーム画面への遷移ボタンを表示          |

**バリデーション一覧**

| エラー概要               | エラーメッセージ                           | エラー原因                   |
| ----------------------- | ----------------------------------------- | --------------------------- |
| 認証コールバックエラー   | 認証に失敗しました。もう一度お試しください。 | Supabase認証でエラーが発生   |
| セッション未確立         | 認証セッションが見つかりません。           | セッションデータが存在しない |
| 予期しないエラー         | 予期しないエラーが発生しました。           | その他の例外が発生          |

## 使用API

| 項目名                      | 機能                           |
| -------------------------- | ------------------------------ |
| supabase.auth.getSession() | 現在の認証セッションを取得      |

## エラー／例外ケース

| エラー概要               | エラーメッセージ                           | エラー原因                   |
| ----------------------- | ----------------------------------------- | --------------------------- |
| 認証エラー               | 認証に失敗しました。もう一度お試しください。 | 認証プロバイダーでエラー発生 |
| セッション取得失敗       | 認証セッションが見つかりません。           | セッションが存在しない       |
| 予期しないエラー         | 予期しないエラーが発生しました。           | システムエラー              |

## 権限による表示制御

| 権限             | アクセス可能URL | 表示内容                                 |
| ---------------- | -------------- | --------------------------------------- |
| 全てのユーザー   | /auth/callback | 認証処理を実行し、結果に応じて画面を表示 |

## 状態／シナリオ別表示仕様

| 状態／シナリオ   | 条件                             | 表示／非表示／制御内容                    | 備考                               |
| --------------- | -------------------------------- | ---------------------------------------- | ---------------------------------- |
| 認証処理中       | ページ初期表示時                 | ローディングスピナーと「認証中...」を表示 | useEffectで認証処理を自動実行       |
| 認証成功         | セッションが正常に取得できた場合 | ホーム画面（/）にリダイレクト            | router.pushを使用                  |
| 認証失敗         | エラーが発生した場合             | エラーメッセージとホームボタンを表示      | エラー内容をstateで管理            |

# 画面遷移元

| 権限             | 遷移元                  | アクション           |
| ---------------- | ---------------------- | -------------------- |
| 全てのユーザー   | 外部認証プロバイダー    | 認証完了後のリダイレクト |

## アクション一覧

| タイトル         | アクション方法          | 説明                                      |
| --------------- | ---------------------- | ----------------------------------------- |
| ホームに戻る     | ボタンクリック         | エラー発生時にホーム画面に遷移             |
| 自動リダイレクト | 認証成功時に自動実行   | 認証が成功した場合、自動的にホームに遷移   |

# 備考

- この画面は認証フローの中間画面として機能し、ユーザーが直接アクセスすることは想定していない
- 認証処理はuseEffect内で自動的に実行される
- エラーハンドリングにより、認証失敗時でもユーザーがアプリケーションに戻れるようになっている